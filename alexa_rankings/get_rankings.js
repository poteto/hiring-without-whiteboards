'use strict'

const fs = require('fs');
const cheerio = require('cheerio');
const Bluebird = require('bluebird');

const request = Bluebird.promisify(require("request"), { multiArgs: true });
Bluebird.promisifyAll(request, { multiArgs: true });

const urls = [
'https://www.ableton.com/en/about',
'https://angel.co/abstract/jobs',
'https://www.accenture.com/us-en/careers',
'https://www.accredible.com/careers',
'https://acko.com',
'http://www.acumenci.com/joinourteam',
'http://adthena.com',
'https://angel.co/adwyze/jobs',
'https://www.aerofs.com/company/careers',
'https://affinity.recruiterbox.com/#content',
'https://angel.co/agilemd/jobs',
'https://careersatagoda.com/departments/technology',
'https://airbrake.io',
'http://aiwip.com',
'http://ajira.tech',
'https://www.algolia.com/careers',
'https://www.allaboutapps.at/jobs',
'https://allegro.pl/praca',
'https://alluvium.io',
'https://engineering.alphasights.com',
'https://gastrograph.com',
'https://apolloagriculture.com',
'https://www.beapplied.com',
'https://angel.co/arachnys/jobs/220465-software-engineer',
'https://articulate.com/company/careers',
'https://www.artsy.net/jobs#engineering',
'https://www.asidatascience.com/careers',
'https://jobs.asos.com/epostings/index.cfm?fuseaction=app.jobsearch&company_id=30071&version=1&byBusinessUnit=5',
'https://jobs.ataccama.com',
'https://atech.media',
'https://auth0.com/blog/how-we-hire-engineers',
'https://automattic.com/work-with-us',
'https://github.com/AutoScout24/hiring',
'https://avant.com/jobs',
'https://www.avarteq.com/career',
'https://www.avocarrot.com/company',
'https://axiacore.com',
'https://boards.greenhouse.io/b12#.WMlLfRIrJTa',
'http://somos.b2wdigital.com/bit',
'https://github.com/Babylonpartners/iOS-Interview-Demo',
'http://careers.backbase.com',
'https://team.badoo.com/jobs',
'https://career012.successfactors.eu/sfcareer/jobreqcareer?jobId=46145&company=BAE',
'https://bakkenbaeck.com/jobs',
'https://career.balabit.com',
'https://basecamp.com/about/jobs',
'http://belka.us/lavora-con-no',
'https://bemind.recruitee.com',
'https://bendyworks.com/careers',
'https://www.betterment.com/careers',
'https://www.bignerdranch.com/about/careers',
'https://www.bioconnect.com/company/careers',
'https://www.bitexpert.de/karriere',
'http://blackdotsolutions.com',
'http://bleacherreport.com',
'https://blendle.homerun.co/?lang=en',
'https://github.com/blogfoster/join-the-engineering-team',
'https://www.bluebottlecoffee.com/careers',
'http://www.bluesoft.com.br',
'https://bocoup.com/careers',
'http://careers.bolste.com',
'https://www.bookingsync.com/en/jobs',
'http://boomtownroi.com',
'http://www.bouvet.no',
'http://brainstation-23.com',
'https://breather.com/jobs',
'http://www.brightbytes.net/careers',
'https://angel.co/brightwheel/jobs',
'https://www.bubbl.in/about',
'https://www.bustle.com/labs',
'https://www.busuu.com/jobs',
'https://buttercms.com',
'https://www.bybox.com/company/careers/software-developer',
'http://careers.caci.com/ListJobs/All/Search/location/rome/state/ny/country/us',
'http://www.cakesolutions.net/careers',
'https://canonlabs.io/#',
'https://www.uk.capgemini.com',
'http://www.caravelo.com/softdev',
'http://www.cartegraph.com/company/careers/',
'https://casetext.com/jobs',
'https://cashlink.de',
'http://www.causeway.com/content/opportunity',
'https://centroida.co/contact.html',
'https://chainreaction.io',
'https://chargify.com/jobs',
'https://chatgrape.com/de/jobs/javascript-developer',
'https://checkout51.com/jobs',
'https://circleci.com',
'https://boston.gov/analytics',
'https://beta.phila.gov/departments/office-of-open-data-and-digital-transformation/jobs',
'https://www.civisanalytics.com/careers',
'https://clara.com/careers',
'https://www.clickmagick.com',
'https://www.cwconsult.dk',
'https://www.cloudistics.com/careers',
'https://www.clubhouse.io/hiring',
'https://www.cognitect.com/jobs',
'https://www.cognitivelogic.com',
'http://www.cognitran.com/employment-opportunities',
'https://www.compeon.de/karriere',
'http://about.cph.org/careers.html',
'http://contactlab.com/en/careers',
'https://www.contentful.com/careers',
'https://www.contentsquare.com/careers',
'https://cookpad.com/us',
'https://www.coorpacademy.com',
'https://creditkudos.com/jobs',
'https://jobs.jobvite.com/careers/crowdstrike/jobs',
'https://crownstone.rocks/jobs',
'https://www.culturefoundry.com',
'https://www.currencytransfer.com',
'https://darksky.net/jobs',
'http://www.datacentred.co.uk/careers',
'https://datascope.co/careers',
'http://www.datlinq.com/en/vacancies',
'https://www.defmethod.com',
'https://deliveroo.co.uk/careers',
'https://www.deskbookers.com/en-gb/jobs',
'https://www.desmart.com',
'https://www.detroitlabs.com/careers',
'https://www.devmynd.com',
'https://www.dg-i.net',
'http://www.dice.se',
'http://www.di.fm/jobs',
'https://digitalocean.com',
'https://www.dollarshaveclub.com',
'http://door2door.io',
'https://doordash.com/careers',
'https://docs.google.com/document/d/1fC_-liTPpYQOoE_5iKj0O3AwSdPggQGnOsjUKahfbkQ/edit?usp=sharing',
'https://www.drawbotics.com/en/join-us',
'https://www.drchrono.com/careers',
'https://www.drivy.com',
'https://www.dronedeploy.com/careers.html',
'http://blog.dubizzle.com/uae/job-vacancies',
'https://www.e-accent.com',
'http://easytaxi.com.br',
'https://eaze.com/careers',
'https://echobind.com/careers',
'https://jobs.edenspiekermann.com',
'http://eidu.com',
'http://www.elpassion.com',
'https://www.elements.nl/careers',
'https://www.ellucian.com/aboutus/careers',
'https://elmah.io',
'https://goo.gl/N7SMKl',
'https://www.emarsys.com',
'http://www.endava.com/en/Careers',
'https://enki.com',
'https://ento.com/blog/ento-interview-process-101',
'https://www.equalexperts.com',
'https://www.ericsson.com',
'https://www.etixeverywhere.com/en/job-offers',
'https://euranova.eu',
'http://www.europaymentgroup.com',
'https://exoscale.ch',
'https://fdex.com.br',
'https://www.fatmap.com',
'https://fauna.com',
'https://feather-cfm.com',
'https://blog.findy.us/findy-saiyo',
'https://www.wearefine.com/careers',
'https://thefitbot.com/careers.html',
'https://food52.com/jobs',
'https://fooji.com',
'https://www.formidable.com/careers',
'https://founders.as/joinus',
'http://www.foundryinteractive.com/contact',
'https://www.fournova.com/jobs',
'https://www.freeagent.com/company/careers',
'https://www.freeletics.com/en/corporate/jobs',
'https://frontside.io/careers',
'https://www.funda.nl/vacatures',
'https://www.fundapps.co/about-us/join-our-team',
'https://www.gamevycareers.com',
'https://gathercontent.com/careers/designer',
'http://jobs.ginetta.net',
'https://about.gitlab.com/jobs',
'https://gitlab.com/gitlab-org/gitlab-ce/issues',
'https://www.gitprime.com',
'https://gocardless.com/about/jobs',
'https://www.godaddy.com/careers/overview',
'https://www.graffino.com',
'http://www.gramercytech.com',
'https://www.grandcentrix.net/jobs',
'https://www.graph.cool',
'https://www.graphistry.com/careers',
'https://www.grok-interactive.com',
'http://www.gruntwork.io',
'https://gtmsportswear.com/careers',
'https://happyteam.io',
'http://www.happypie.com',
'https://hashrocket.com',
'https://helabs.com',
'https://www.hellofresh.com/jobs',
'https://www.heptio.com/jobs',
'http://www.hhcc.com/careers',
'http://www.hireology.com/careers',
'https://holidaypirates.group/en/jobs',
'https://www.homechef.com/careers',
'https://jobs.hoxhunt.com',
'http://humanapi.co/company/careers',
'https://io.co.za/opportunities',
'http://icalialabs.com',
'https://boards.greenhouse.io/scout24',
'http://jobs.impraise.com',
'http://www.indellient.com/careers',
'https://inkindcapital.com',
'https://www.inmar.com/careers',
'https://inquicker.com',
'https://careers.instacart.com',
'https://www.intercom.com/careers',
'https://interset.com/careers',
'https://www.ithaka.travel',
'http://itrellis.com',
'http://www.jamasoftware.com',
'https://jamitlabs.com/jobs',
'https://www.jitbit.com',
'https://journaltech.com/jobs',
'http://www.jplusplus.org',
'http://internship.jplusplus.org',
'https://www.justwatch.com/us/talent',
'https://www.getkahoot.com/jobs',
'https://www.kayako.com',
'https://keymetrics.io',
'https://github.com/keymetrics/keymetrics-api',
'https://careers.kindredplc.com',
'https://www.kinnek.com/jointeam',
'https://code.kiwi.com',
'http://www.koddi.com/open-positions',
'http://www.kongregate.com/jobs',
'https://www.korbit.co.kr/about/jobs',
'https://lab.coop',
'https://landing.jobs/at/landing-jobs',
'http://engineering.lanetix.com',
'https://engineering.lanetix.com/2015-10-20/hiring-process',
'http://careers.laterooms.com',
'https://launchacademy.com/careers',
'https://www.legalstart.fr',
'https://www.libertymutualgroup.com/careers',
'https://www.librato.com/jobs',
'http://lightningjar.agency',
'http://www.lightricks.com',
'http://jobs.linkresearchtools.com/job-offers',
'https://listium.com/jobs',
'https://litmus.com/careers#openings',
'https://www.littlethings.com/careers.html',
'https://loanzen.in/team.html#Career',
'https://www.locastic.com/posao',
'https://www.locaweb.com.br/carreira',
'http://www.lookbookhq.com/about/careers',
'https://lydia-app.com/en/company/jobs',
'https://lyft.com/jobs',
'http://www.lyoness-corporate.com/de-AT/Karriere/Jobangebote',
'https://www.madetech.com/careers',
'https://github.com/madetech/handbook/tree/master/guides/hiring#20-minute-phone-conversation',
'https://magnetis.workable.com',
'https://careers-mlssoccer.icims.com/jobs/search?ss=1&searchCategory=20285',
'https://maketime.workable.com',
'http://www.mango-solutions.com/wp/about-mango/team',
'https://www.mapbox.com/jobs',
'https://www.mavenlink.com/careers',
'https://www.maxwellhealth.com/careers',
'https://mediapop.co',
'http://underthehood.meltwater.com/jobs',
'https://mention.workable.com',
'https://www.mercatus.com/company/careers',
'https://www.mfind.pl/dolacz-do-nas/',
'https://midrive.com/careers',
'https://www.milchundzucker.de',
'https://mimirhq.com/jobs/',
'http://www.minutemedia.com/careers/',
'https://mirumee.com/jobs',
'https://mixmax.com/careers',
'https://www.mobilecashout.com',
'https://about.modeanalytics.com/careers',
'http://mokahr.com',
'https://moneytree.jp',
'https://monzo.com',
'https://mutualmobile.com/careers',
'http://www.mutualofomaha.com/careers',
'https://www.mutuallyhuman.com',
'https://nanobox.io',
'https://www.native-instruments.com',
'http://lifeatnedap.com/vacatures',
'https://jobs.netflix.com/jobs/861237',
'https://www.netguru.co/career',
'https://www.netlify.com/careers',
'https://newrelic.com/about/careers',
'https://www.newvoicemedia.com/about-newvoicemedia/careers',
'https://www.workhiro.com/companies/nimbl3',
'http://www.niteoweb.com/careers',
'https://www.noa.one',
'http://nodesource.com/careers',
'https://www.nomoko.world/jobs',
'https://www.nordsoftware.com/en/jobs',
'https://www.noredink.com/jobs',
'https://novicap.com/en/careers.html',
'https://novoda.com/hiring',
'https://github.com/novoda/dojos',
'https://www.novus.com/jobs',
'https://nozbe.com/jobs',
'https://npmjs.com/jobs',
'https://nubank.workable.com',
'https://www.numberly.com',
'https://angel.co/numerai/jobs',
'https://www.nutshell.com/jobs',
'https://github.com/nutshellcrm/join-the-team',
'https://oreilly.com/jobs',
'https://www.objectiveinc.com/careers',
'https://www.omadahealth.com/jobs',
'https://onfido.com/jobs',
'https://ontame.io',
'https://opbeat.com/jobs#seniorbackendengineer',
'http://www.optoro.com/open_position_item/?oid=134960',
'https://orionlabs.io',
'http://www.ostmodern.co.uk',
'https://www.outbrain.com/jobs',
'https://outlandish.com',
'https://github.com/outlook/jobs',
'https://www.nerdery.com/careers',
'https://boards.greenhouse.io/theoutline',
'https://www.pace.car/jobs',
'https://www.paessler.com/company/career/jobs',
'https://pagar.me',
'https://pager.com',
'https://pagerduty.com/careers',
'https://tech.palatinategroup.com',
'http://parabol.co',
'https://github.com/ParabolInc/action/projects',
'http://parivedasolutions.com',
'https://passfort.com/about#jobs',
'https://www.paybyphone.com/careers',
'https://info.peerstreet.com/careers',
'https://angel.co/pento/jobs',
'https://www.phoodster.com',
'http://pillartechnology.com/careers',
'https://platform.sh',
'https://platform45.com',
'https://getcatalyst.in/careers',
'https://www.pluralsight.com/careers',
'http://pointman.bamboohr.com/jobs/',
'http://jobs.poki.com',
'http://polar.me/company/careers',
'http://www.popstand.com',
'http://www.popularpays.com',
'https://pragma.team/talent',
'https://www.premiumbeat.com/careers',
'https://www.promptworks.com/jobs',
'https://pusher.com/jobs',
'http://pygmalios.com/en',
'https://quietlightcom.com/positions-web.php',
'http://www.workatquintype.com',
'https://ragnarson.com',
'https://www.raisingit.com',
'https://jobs.rakuten.careers/careersection/rakuten_ext_cs/jobdetail.ftl?job=00000751&tz=GMT%2B09%3A00',
'http://www.rapyuta-robotics.com/pages/jobs.html',
'https://rayfeed.com',
'https://razorpay.com/jobs',
'https://reaktor.com/careers',
'https://www.redcarpetup.com/jobs',
'https://www.rentify.com/jobs',
'https://www.rentomojo.com/about/careers',
'https://www.respark.co.uk',
'https://www.restaurantops.co',
'https://revlv.net',
'https://www.rexsoftware.com/careers',
'https://rizk.com',
'http://www.rockode.com',
'https://rubygarage.org',
'https://www.runtastic.com',
'https://www.sahajsoft.com',
'http://www.salesforce.org',
'https://sc5.io/careers',
'https://sensortower.com/jobs',
'http://sentisis.com/trabaja-con-nosotros',
'https://setapp.pl/career',
'https://blog.showmax.com/engineering-careers',
'https://shuttlecloud.com/jobs',
'https://www.simpli.fi/about-us/careers',
'http://www.welcometothejungle.co/companies/simplifield/jobs',
'https://www.simplybusiness.co.uk/about-us/careers/tech',
'http://sixt4.io/jobs',
'https://slack.com/jobs',
'https://www.small-improvements.com/careers',
'http://www.socialtables.com',
'http://www.socialcops.com',
'http://nl.softwear.nl/vacatures',
'http://sogilis.com',
'https://www.spreedly.com/jobs',
'https://engineering.spreedly.com/blog/programming-puzzles-are-not-the-answer-how-spreedly-does-work-samples.html',
'https://www.natureasia.com',
'https://www.spronq.nl',
'https://squareup.com/careers',
'http://srijan.net',
'http://stardog.com',
'https://www.store2be.com/de/jobs/tech',
'https://getstreetteam.com/careers',
'http://www.stylabs.in',
'https://verticalchange.com/job_posts',
'https://superplayer.fm',
'http://svti.svt.se',
'https://sweetiq.com/about/careers',
'https://www.symphonycommerce.com/careers',
'http://sysgarage.com',
'https://tails.com/careers',
'http://tanookilabs.com',
'https://www.tattoodo.com',
'https://labs.telus.com',
'https://tenthousandcoffees.com',
'https://www.tesco.com',
'https://thebookofeveryone.workable.com',
'http://mobile.thescore.com/careers',
'http://www.thinslices.com',
'https://thoughtbot.com/jobs',
'https://thoughtbot.com/playbook/our-company/hiring#interviewing',
'https://www.thoughtworks.com/careers',
'https://www.thread.com/jobs',
'https://www.threatspike.com',
'http://www.tilde.io',
'https://www.timbuktutravel.com',
'http://toucantoco.com/fr/team#jobs',
'https://trademark.vision',
'https://www.trivago.com',
'https://boards.greenhouse.io/trov',
'https://jobs.trustpilot.com',
'https://www.twistlock.com',
'https://ubiome.com/careers',
'http://ubots.com.br',
'https://unbounce.com',
'https://unboxed.co',
'http://www.unearthlabs.com/careers',
'https://www.untappd.com',
'http://www.updater.com/jobs/openings',
'http://uprise.se',
'https://www.urbanmassage.com/jobs',
'https://www.usertesting.com/about-us/jobs',
'https://www.uswitch.com/vacancies',
'http://www.valassis.com/digital-advertising',
'https://valuemotive.com/en/career',
'https://www.varsitytutors.com',
'http://vayu.com.au',
'https://www.venminder.com',
'https://www.e-conomic.dk/om/job',
'https://jobs.lever.co/vivareal/',
'https://voltra.co',
'http://lab.vtex.com/careers',
'https://boards.greenhouse.io/vts',
'https://www.wealthsimple.com/work-with-us',
'http://www.wearehive.co.uk',
'https://webantic.co.uk/careers',
'https://webflow.com',
'https://weedmaps.com/careers',
'https://wheely.com/en/careers',
'https://wildbit.com',
'http://wimdujobs.com',
'https://worldgaming.com',
'https://wyeworks.com',
'http://x-team.com',
'https://www.xing.com',
'http://www.1000mercis.com/#!/careers/?lang=en',
'https://pages.18f.gov/joining-18f',
'https://3dhubs.com/jobs',
'http://500friends.com/who-we-are/careers',
'https://500Tech.com',
'https://8thlight.com',
'https://www.yhat.com/jobs',
'https://yld.breezy.hr',
'https://yodas.com',
'http://yoyowallet.com',
'http://www.yunojuno.com',
'https://www.zenefits.com/careers'];

const normalizeUrl = (u) => {
  if (u.indexOf('https://') > -1) {
    u = u.split('https://')[1];
  } else {
    u = u.split('http://')[1];
  }

  if (u.indexOf('www.') > -1) {
    u = u.split('www.')[1];
  }

  if (u.indexOf('/') > -1) {
    u = u.split('/')[0]
  }

  return u;
}

const urlsWithRankings = [];

Bluebird.map(urls, (url) =>
  request(`http://www.alexa.com/siteinfo/${normalizeUrl(url)}`)
  .then((res) => {
    const body = res[0].body;
    const $ = cheerio.load(body);
    const rankingStr = $('.globleRank .metrics-data').text().trim();
    const rankingNum = parseInt(rankingStr.replace(',', '').replace(' ', ''), 10);
    const obj = {
      url,
      normalizedUrl: normalizeUrl(url),
      rankingStr,
      rankingNum
    };

    urlsWithRankings.push(obj);
    if (urlsWithRankings.length % 10 === 0 || urlsWithRankings.length === urls.length) {
      const sorted = urlsWithRankings.sort((a, b) => {
        if (!a.rankingNum || ['github.com', 'docs.google.com'].indexOf(a.normalizedUrl) > -1) {
          return 1;
        }

        if (!b.rankingNum || ['github.com', 'docs.google.com'].indexOf(a.normalizedUrl) > -1) {
          return -1;
        }

        return a.rankingNum - b.rankingNum;
      });

      fs.writeFile('./output.json', JSON.stringify(sorted, null, 2));
    }

    return obj;
  })
  .catch(err => console.log(err)), { concurrency: 3 });
